<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitar Pesquisa - Imprensa Oficial AP</title>
    
    <link rel="shortcut icon" href="img/favicon1.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/estilo.css">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
    <script src="js/busca.js"></script>
</head>
<body>
    <div class="caixa-central">
        <div class="topo-container"><div class="topo-banner"></div></div>
        
        <nav class="navbar-gov">
            <button class="btn-menu-mobile" onclick="toggleMenu()">
                <i class="bi bi-list"></i> MENU DE NAVEGAÇÃO
            </button>
            <ul class="menu-lista" id="menuPrincipal">
                <li><a class="nav-link" href="index.html">Início</a></li>
                <li><a class="nav-link" href="acervo.html">Acervo Histórico</a></li>
                <li><a class="nav-link active" href="solicitacao.html">Solicitar Pesquisa</a></li>
                <li><a class="nav-link" href="publique.html">Como Publicar</a></li>
                <li><a class="nav-link" href="noticias.html">Notícias</a></li>
                <li><a class="nav-link" href="institucional.html">Institucional</a></li>
                <li><a class="nav-link" href="javascript:void(0);" onclick="abrirBusca()"><i class="bi bi-search"></i> BUSCAR</a></li>
            </ul>
        </nav>

        <div class="banner-id"></div>

        <main class="conteudo-principal">
            <h2 class="titulo-pg">SOLICITAÇÃO DE PESQUISA AO ACERVO</h2>
            
            <div class="row justify-content-center">
                <div class="col-md-9">
                    
                    <div class="alert alert-info text-start shadow-sm border-start border-4 border-info">
                        <h5 class="alert-heading fw-bold"><i class="bi bi-info-circle-fill"></i> Como funciona?</h5>
                        <p class="mb-0">
                            O acervo do NIO contém documentos históricos desde 1945. Ao preencher este formulário, 
                            <strong>nossa equipe de servidores receberá seu pedido</strong>, realizará a busca manual nas edições do 
                            <strong>Diário Oficial</strong> e entrará em contato com você via WhatsApp com o resultado.
                        </p>
                    </div>

                    <div class="card shadow border-0 mt-4">
                        <div class="card-header text-white fw-bold py-3" style="background-color: var(--azul);">
                            <i class="bi bi-pencil-square"></i> PREENCHA OS DADOS DA PESQUISA
                        </div>
                        <div class="card-body p-4 text-start">
                            
                            <form id="formPesquisa" onsubmit="enviarPedido(event)">
                                
                                <h5 class="text-secondary mb-3 border-bottom pb-2">1. Seus Dados de Contato</h5>
                                <div class="row g-3 mb-4">
                                    <div class="col-md-7">
                                        <label class="form-label fw-bold">Seu Nome Completo:</label>
                                        <input type="text" class="form-control bg-light" name="solicitante" required placeholder="Digite seu nome...">
                                    </div>
                                    <div class="col-md-5">
                                        <label class="form-label fw-bold">Seu WhatsApp (com DDD):</label>
                                        <input type="text" class="form-control bg-light" name="whatsapp" id="campoZap" required placeholder="(96) 9xxxx-xxxx">
                                        <div class="form-text text-success"><i class="bi bi-whatsapp"></i> É por aqui que enviaremos o PDF se encontrarmos.</div>
                                    </div>
                                </div>

                                <h5 class="text-secondary mb-3 border-bottom pb-2">2. Dados da Pesquisa Histórica</h5>
                                <div class="mb-3">
                                    <label class="form-label fw-bold" style="color: var(--azul);">Nome exato a ser pesquisado no Diário:</label>
                                    <input type="text" class="form-control border-primary" name="nome_pesquisado" required placeholder="Ex: Nomeação de João Silva ou Decreto 123/1950">
                                    <div class="form-text">Informe o nome, lei ou decreto exatamente como deve constar no documento oficial da época.</div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label fw-bold">Qual o ano ou período aproximado?</label>
                                    <input type="text" class="form-control" name="periodo" required placeholder="Ex: Entre 1950 e 1955">
                                    <div class="form-text">Se não souber a data exata da publicação, informe um intervalo.</div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label fw-bold">Observações Adicionais (Opcional):</label>
                                    <textarea class="form-control" name="observacoes" rows="3" placeholder="Ex: Acredito que foi publicado no mês de Março..."></textarea>
                                </div>

                                <div class="d-grid gap-2">
                                    <button type="submit" id="btnEnviar" class="btn btn-success fw-bold py-3 fs-5 shadow-sm" style="background-color: var(--verde);">
                                        <i class="bi bi-send-check"></i> ENVIAR SOLICITAÇÃO PARA ANÁLISE
                                    </button>
                                </div>
                                
                                <div id="statusEnvio" class="mt-3" style="display:none;"></div>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="rodape-oficial">
            <img src="img/banner-governo-rodape.png" alt="Governo do Amapá" class="img-rodape">
        </footer>
    </div>

    <script>
        function toggleMenu() { document.getElementById('menuPrincipal').classList.toggle('ativo'); }
        
        $(document).ready(function(){
            $('#campoZap').mask('(00) 00000-0000');
        });

        function enviarPedido(e) {
            e.preventDefault(); 
            
            const btn = document.getElementById('btnEnviar');
            const statusDiv = document.getElementById('statusEnvio');
            const form = document.getElementById('formPesquisa');
            
            const dados = {
                acao: 'novo_pedido',
                solicitante: form.solicitante.value,
                nome_pesquisado: form.nome_pesquisado.value,
                periodo: form.periodo.value,
                whatsapp: form.whatsapp.value,
                observacoes: form.observacoes.value
            };

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Enviando para o sistema...';
            statusDiv.style.display = 'none';

            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwwEI9F6LFkqOqeoF4kKyARouJo-59C-34xhTWfL1bDD538muTldssosywD2G2CYyOpfA/exec'; 

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(dados)
            })
            .then(() => {
                statusDiv.innerHTML = `
                    <div class="alert alert-success text-center">
                        <h4><i class="bi bi-check-circle-fill"></i> Solicitação Enviada!</h4>
                        <p>O protocolo foi aberto em nosso sistema com status <strong>EM ANÁLISE</strong>.<br>
                        Nossa equipe fará a busca no Diário e entrará em contato.</p>
                    </div>
                `;
                statusDiv.style.display = 'block';
                form.reset();
                setTimeout(() => { 
                    btn.disabled = false; 
                    btn.innerHTML = '<i class="bi bi-send-check"></i> ENVIAR SOLICITAÇÃO PARA ANÁLISE';
                }, 5000);
            })
            .catch(error => {
                statusDiv.innerHTML = '<div class="alert alert-danger">Erro ao enviar. Verifique sua conexão.</div>';
                statusDiv.style.display = 'block';
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-send-check"></i> ENVIAR SOLICITAÇÃO PARA ANÁLISE';
            });
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>